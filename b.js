(()=>{const e=Math.random,t=(t,a)=>e()>.5?-1:1;const a=e=>new Promise((t=>setTimeout(t,~~(1*e)))),n=e=>document.createElementNS("http://www.w3.org/2000/svg",e),s=e=>document.createElement(e),l=(e,t,a)=>e.setAttribute(t,a),r=(e,t)=>e.appendChild(t),o=e=>document.getElementById(e),i=(e,t)=>e.classList.add(t),c=(e,t)=>e.classList.remove(t),d=(e,t)=>e.classList.contains(t),h=(e,t)=>e.classList.toggle(t),p=(e,t)=>localStorage.setItem(`13ksp-${e}`,t),m=(e,t)=>localStorage.getItem(`13ksp-${e}`)||t,v=()=>location.reload(),g=[1,10,25,25,20,5,10,15,2],u=[10,18,4,10,45,35,30,25,25,15,18,3,1],w=[2,30,30,28,50,28,20,20,15,1],M=[2,30,30,28,50,28,20,20,15,1],f=[10,12,10,10,5,2,8,6,4,4,2,2],y=[10,10,6,6,3,6,6,3,6,3,3,1,1,1,1,1,3,5],b=[1,1,1,20,10,20],z=(t,a)=>~~(e()*(a-t))+t,$=(t,a)=>{const n=a.reduce(((e,t)=>e+t),0),s=((t=getConfigForId(~~(1e3*e())),a,n)=>~~(t()%(n-a)+a))(t,0,n);let l=0;for(let e=0;e<a.length;e++)if(l+=a[e],s<l)return e;return a.length-1},L=["m50 39-7-24-7 24-6 24V84l14 14 14-14V62z","m49 35 23-13L68 1l14 11 4 23-30 22zM37 35 14 22 19 1 5 11 1 34l30 23z","M49 65a6 6 0 0 0-10 0l-5 9V83l10-4L54 83v-9zM37 35l3 5-3 13-6 4zm12 0-3 5 3 13 7 4zM80 39l-9-5-8 6 1 11zM69 5l5 4 1 6-3 5zM8 39l10-5 8 7-1 11zM18 5l-6 4-1 6 3 5z","M43 15v20m0 5v5M77 28 52 43M35 43 10 28"],C=["M8 37 4 40 1 37V11L4 1l4 11v25z","M21 33h16V13H21L8 18v12l13 3zM1 15l4 3V28L1 33V15z","M13 16v7m4-8v6"],k=["M33 24S27 41 14 50 1 71 1 71h42V1z","M24 71v-15m-6 15V59"],V=["M9 6h4v16h-4zM21 1h4v20h-4z","M16 15H1v6l16 5zM59 41l-22-7V15h22z","M37 15H16v14l21 8zM1 22V7l3-3v18z","M19 30l2-4 8 3 2 6z"],H="pieces",S="scale",I="translate",T="leftTranslate",A="rightTranslate",x="styles",B={0:{[H]:["m30 89-19-4v6l19 8 19-8v-6l-19 4zm13-46V31l3-5v-9l-3-3V5h5l12 19v11l-7 29zM30 63v26L8 84V64zM17 44V31l-3-5v-9l3-3V5h-5L1 24v11l7 29zm13 19v26l23-5V64l-23-2z","m2 40 6 1 2 8-4 7zm40 3-12-2-13 2-9 21 22-2 23 2-10-21zm17-3-6 1-2 8 4 7z","m30 68 8 2v17m-8-19-8 2v17m8-25V41M15 5V0m31 5V1M9 20v8l4 4v4H1m51-16v8l-3 4v4h11"],[I]:[-6,20],[S]:[.75,.75],[x]:[0,1,0,1]},1:{[H]:["M28 0c-9 11-11 25-11 25V83h23V26S37 11 28 0z","M22 54s-4 11-12 17-9 14-9 14h21zm13 0s4 11 12 17 9 14 9 14H34zM22 85h13v8h-13z","M28 32c-8 4-8 25-8 25v30h17V57s0-21-8-25z","M30 97h-3V70a1 1 0 0 1 1-1 1 1 0 0 1 1 1zM20 63l4 2v9l-4 2V63zm17 0-4 2v9l4 2z","M11 85v-7m4 7V74m29 11v-7m-4 7V74"],[I]:[-10,0],[S]:[1,1],[x]:[1,1,0,1]},2:{[H]:["M31 37 19 2l-3-1-3 1L3 37 1 64v19l6 10 10 6 10-6 6-10z","m9 15 3 5-2 10-6 3zm15 0-3 5 3 10 6 3zM7 93l10-9 10 9-10 6zm9-45L6 60v3l10-7 12 7v-3z","M16 48V1m13 35h-5m7 4h-8m-15 0H3m7-4H2m14 20L6 63v17h22V63z"],[I]:[4,10],[S]:[.9,.9],[x]:[0,1,0,1]},3:{[H]:["M22 25 14 1 7 25 1 49v23l14 15 14-15V49z","m21 52-6-10-6 10-5 10v9l11 6 11-6v-9zM8 21l3 5-2 13-6 4zm13 0-3 5 3 13 6 4z","M14 1v22m0 5v5"],[I]:[4,10],[S]:[1,1],[x]:[0,1,0,1],[x]:[0,1,0,1]},4:{[H]:["M5 80H23V93H5z","M13 2C0 7 1 22 1 22v63h26V22S26 7 14 2z","M16 99h-4V58a2 3 0 0 1 2-3 3 3 0 0 1 2 3zm-2-84s-7 0-9 5h18c-2-5-9-5-9-5zM1 48l7 4v14L1 70v-22zm26 0-7 4v14l7 3z","M26 22H1M26 27h-8m8 3h-8m-10-3H1m8 3H1"],[I]:[4.5,0],[S]:[1,1],[x]:[1,0,1,1]},5:{[H]:["M39 22 32 1 26 22l-6 22v20L32 99l12-34v-20z","m37 47-5-9-5 9-5 9v8l10 5 10-5v-8zm7-2 14 20v14L44 64zM27 19l3 5-3 12-5 3zm11 0-3 5 3 12 5 3zM20 44 6 64v14l14-14z","M16 50v5l-3 4-4 0zm31 0v5l3 4 4 0z","M32 1v24m0 3v7"],[I]:[-14,0],[S]:[1,1],[x]:[0,1,0,1]},6:{[H]:L,[I]:[-26,-10],[S]:[1,1],[x]:[0,0,1,0]},7:{[H]:["M16 1C9 8-11 34 9 93v5h17v-5c20-59 0-85-7-92a3 3 0 0 0-4 1z","M18 22V99M10 21v8m15 0v-8M10 31v4m15 0v-4","M18 22a44 45 1 0 0 13-2c-4-10-8-16-11-19a3 3 0 0 0-4 0C13 4 8 10 5 20a45 45 0 0 0 13 2zM18 59a3 3 0 0 0-3 3V95h6V61a3 3 0 0 0-3-2z"],[I]:[.5,0],[S]:[1,1],[x]:[0,0,1,0]},8:{[H]:L,[I]:[-18,-90],[S]:[.7,-1.4],[x]:[0,1,0,0]}},E={0:{[H]:C,[I]:[5.5,50],[S]:[1,1],[T]:[-20,0],[A]:[-47,0],[x]:[0,1,0]},1:{[H]:["M23 1 8 23v16l15-16 14 0V1H23z","M8 8v42L1 43V30l7-22z","M1 30h7v9H1z","M18 8v6l-3 5-4 1L18 8z"],[I]:[5.5,60],[S]:[1,1],[T]:[-25,0],[A]:[-50,0],[x]:[0,1,0,1]},2:{[H]:k,[I]:[11.5,45],[S]:[.7,.7],[T]:[-40,0],[A]:[-70,0],[x]:[1,0]},3:{[H]:["M6 1c-5 5-5 17-5 17v50h10V17S12 5 6 1z","M12 70H0l1-7h10l1 7zm-1-28h14v7H11z","M7 18H1M7 24H1"],[I]:[0,28],[S]:[1,1],[T]:[-6.5,0],[A]:[-43.5,0],[x]:[0,1,0]},4:{[H]:["M8 26h4v15H8zm11-7h4V47H19zm36 16V10l-21 5v18z","M34 33H15V20l19-8v21z","M15 33H1v-6l14-5v11zm3-14 2 3 8-3 2-5-12 5zM55 1 38 9v5l17-4z"],[I]:[7,52],[S]:[.85,.85],[T]:[-53,0],[A]:[-81,0],[x]:[0,1,0]},5:{[H]:["M22 6 7 15v15l15-3 14 0V6H22z","M7 1v40L1 34V22L7 1zm4 12c0 0 0 8 0 8L16 26V10"],[I]:[5,45],[S]:[1,1],[T]:[-20,0],[A]:[-46,0],[x]:[1,0]},6:{[H]:V,[I]:[-1.5,52],[S]:[.85,.85],[T]:[-45,0],[A]:[-90,0],[x]:[0,1,0,1]},7:{[H]:["M41 1 4 28a8 8 0 0 0-3 6v6l40-9z","m20 16 2 7m-9-2 1 5","m1 36 40-13"],[I]:[-4,70],[S]:[.85,.85],[T]:[-20,0],[A]:[-70,0],[x]:[1,1]},8:{[H]:C,[I]:[-1,-95],[S]:[1.5,-1],[T]:[-20,0],[A]:[-47,0],[x]:[1,0,0]},9:{[H]:V,[I]:[-1.5,-98],[S]:[.85,-.85],[T]:[-45,0],[A]:[-90,0],[x]:[1,0,1,0]},10:{[H]:k,[I]:[1.5,170],[S]:[1.1,.3],[T]:[-38,0],[A]:[-68,0],[x]:[0,1]},11:{[H]:V,[I]:[-1.5,28],[S]:[.85,.85],[T]:[-45,0],[A]:[-90,0],[x]:[1,1,0,1]},12:{[H]:[],[I]:[0,0],[S]:[1,1],[T]:[0,0],[A]:[0,0],[x]:[]}},N=[[],[.95,.5,108,.5,.9,1],[.7,1,0,5,1.1,0],[.7,1,45,1,1.3,0],[.6,1,90,3,1.1,0],[.4,1,135,12,1.1,0],[.6,1,180,6,1.3,0],[.12,1,225,3,3.9,0],[.4,1,270,3,1.2,0],[.4,1,320,4,1.3,0],[.9,1,0,2,.8,1],[1.6,1,38,13,2,1],[1.01,1,90,4,1,1],[1.4,1,135,13,1.5,1],[.83,1,180,18,1,1],[.65,1,225,6,1,1],[1.1,1,270,18,.9,1],[.75,1,315,8,1,1]],P=[[-1,0],[0,0],[1,0],[2,0],[3,0],[4,0],[-1,1],[0,1],[1,1],[2,1],[3,1],[4,1]],q=["shadow proclamation","skulz","borgz","rebels","the empire","federation"],O=["icarus","uscss","x-78","nightfly","z-wolf","legacy","bebop","yamato","nautilus","hyperion"],j=["hunter","liberator","explorer","searcher","rider","seeker","skywalker","destroyer","intrepid","explorer","brave","fearless","conqueror",""],G=["milky way","andromeda","hydra","helix","bw tauri","recursive","void","kraken","omega","xix","dark","ultimate"],R=["discount","skulls","biohazard","lobby","target","trellis"],F="spacewars.neuromancer",_=async e=>{const t=await nearApi.connect((a=Q[ne],{networkId:a,nodeUrl:`https://rpc.${a}.near.org`,walletUrl:`https://wallet.${a}.near.org`,contractName:`${F}.${a}`,deps:{keyStore:new nearApi.keyStores.BrowserLocalStorageKeyStore}}));var a;const n=`${F}.${ne}`,s=new nearApi.WalletConnection(t);contract=await new nearApi.Contract(s.account(),n,{viewMethods:["getAccount","getGame"],changeMethods:["addCredit","getLastBattleLog","joinGame","setHand"],sender:s.account()}),s.isSignedIn()?(De(`connected to ${Q[ne]}`,2400),await D(),h(bye,"hide")):e?(new nearApi.Account(t.connection,n),s.requestSignIn(n)):(netSelect.value=K,p("net",K),v()),logout=async()=>{De("loading...",0),await s.signOut(),p("net",K),v()}};addCreditNear=()=>{De("loading...",0),contract.addCredit({},"20000000000000","100000000000000000000000")};const D=async()=>{if(gameOver)return;let{ships:e=[],credits:t=1,player:a,inQueue:n=-1}=await contract.getAccount({account_id:contract.account.accountId})||{};U(t),a&&((te.id!=a.id||ae.state<=Y)&&(te=se(a.id,a.ship),te.alive="true"==m("pS"),ee=[te]),te.state=a.state,te.arsenal=a.arsenal,te.victories=a.wins),ce(await contract.getGame()),ae.state==X&&n>=0&&(!d(joinGamebtn,"hide")&&je(),joinGameLabel.innerHTML=`${ae.waitingPlayers}/8 players ready to play`),setTimeout(D,1e4)},U=e=>{credits=e,tCredits.innerHTML=`credits ${credits.toString().padStart(3,"0")}`};U(1);const W="mainnet",J="testnet",K="local",Q={[W]:W,[J]:J,[K]:K},X=1,Y=2,Z={0:0,[X]:X,[Y]:Y,3:3,4:4,5:5};let ee,te,ae,ne=K;const se=(e,t)=>{const a=t||z(0,13312),n=ge[a];return{id:e,shipId:a,shipADN:n,config:we(n),alive:!0,arsenal:[0,1,2,z(3,$e.length)],hand:[],ready:!1,victories:0}},le=()=>{ae.round+=1,te.ready=!1,te.hand=[]},re=e=>e.map(((e,t)=>t)).sort(t).splice(0,3),oe="battle is about to start!",ie=(e,t)=>{let a=Ie(e,t);return a===He&&(a=Ie(e,t,!0)),Se[a]};addCredits=()=>{ne!=Q[K]&&addCreditNear()},setHand=async()=>{if(te.hand.length<3)De("choose 3 cards from your arsenal");else{tt=1;const e=et[tt];o("blMe").innerHTML=e,ne==Q[K]?(await De(e),await(async()=>{0===te.hand.length&&(te.hand=re(te.arsenal));const[e]=ee.splice(z(1,ee.length),1);ee.splice(1,~~(ee.length/2)),e.hand=re(e.arsenal);const a=((e,a)=>{let n,s,l={shipA:e.shipId,shipB:a.shipId,arsenalA:e.arsenal,arsenalB:a.arsenal,winner:-1,rounds:[]},r=[0,0],o=0;for(;r[0]<2&&r[1]<2&&!(o>10);){switch(o){case 0:n=e.hand.map((e=>e)),s=a.hand.map((e=>e));break;case 1:n=e.hand.sort(t).map((e=>e)),s=a.hand.sort(t).map((e=>e));break;case 2:n=re(e.arsenal),s=re(a.arsenal);break;default:n=[z(0,e.arsenal.length)],s=[z(0,a.arsenal.length)]}const i=n.reduce(((t,l,r)=>t+ie(e.arsenal[n[r]],a.arsenal[s[r]])),0);i>0&&r[0]++,i<0&&r[1]++,l.rounds.push({handA:n,handB:s}),o+=1}return l.winner=r[0]>r[1]?0:1,l})(te,e);var n;await De(oe,1500),Oe("viewBattle"),Pe(a),n=4,ae.state=n})()):(De("delivering orders...",0),await contract.setHand({hand:te.hand}),td(),await a(400),await De(e,1200))}},loadLastBattle=async()=>{De(oe,0);const e=await contract.getLastBattleLog({account_id:contract.account.accountId});e.rounds=e.rounds.map((([e,t])=>({handA:e,handB:t}))),Oe("viewBattle"),Pe(e),p("pS",5!=te.state),td()};const ce=async e=>{const t=e.round>ae.round;(e.state!=ae.state||t)&&(e.state>=3&&(te.alive&&(t||5==e.state)?await loadLastBattle():5!=te.state&&(ae.state<3?(await a(3e3),td("wait")):Oe("game"))),5==ae.state&&v()),te.alive=5!=te.state,ae=e,ae.state>=3&&"game"!=qe&&at()},de=[],he=(e,t,a)=>{const{[H]:s,[x]:o}=t;s.forEach(((t,s)=>{const i=n("path"),c=a[o[s]];l(i,"fill",`url(#pattern${c})`),l(i,"d",t),r(e,i)}))},pe=(e,t,a=[1,1])=>{l(e,"transform",`scale(${a[0]}, ${a[1]}) translate(${t[0]}, ${t[1]})`)},me=(e,t,a,s)=>{const o=n("svg"),i=[a,s];l(o,"viewBox","0 -50 35 200");const c=n("g");pe(c,[0,0]),l(c,"class","cls-1");const d=E[t],h=n("g");pe(h,d.translate,d.scale);const p=n("g");pe(p,d.leftTranslate),he(p,d,i),r(h,p);const m=p.cloneNode(4);pe(m,d.rightTranslate,[-1,1]),r(h,m),r(c,h);const v=B[e],g=n("g");return pe(g,v.translate,v.scale),he(g,v,i),r(c,g),r(o,c),o},ve=e=>{const[t=1,a=0,n=0,s=0,l=1,r=0]=N[e];document.body.style.filter=`brightness(${t}) sepia(${a}) hue-rotate(${n}deg) saturate(${s}) brightness(${l}) invert(${r})`,dl.style.filter=r?`invert(1) brightness(${1/l}) saturate(2) sepia(1) brightness(${1/t})`:""},ge=[],ue=e=>{const t=(e=>{let t=e+13312;return()=>t=16807*t%2147483647})(e),a={shapeId:$(t,g),wingsId:$(t,u),bgColor:$(t,w),fgColor:$(t,M),bgEffect:$(t,f),pallete:$(t,y),backCover:$(t,b)},n=e=>e.toString(16);let s=`${n(a.shapeId)}`;return s+=`${n(a.wingsId)}`,s+=`${n(a.bgColor)}`,s+=`${n(a.fgColor)}`,s+=`${n(a.bgEffect)}`,s+=`${n(a.pallete)}`,s+=`${n(a.backCover)}`,a.adn=s,a},we=e=>{const t=e.split("").map((e=>parseInt(e,16)));return{shapeId:t[0],wingsId:t[1],bgColor:t[2],fgColor:t[3],bgEffect:t[4],pallete:t[5],backCover:t[6]}},Me=e=>{d(e,"cf")?(i(e,"cu"),setTimeout((()=>{c(e,"cf"),c(e,"cu")}),500)):i(e,"cf")},fe=(e,t,a,n="")=>{const l=s("div");l.className=`card ${n}`;const r=s("div");r.className=`card-face ${R[e]} card-backing`,l.appendChild(r);const o=s("div");return o.className="card-face card-front",t.forEach((e=>o.appendChild(e))),l.appendChild(o),l.onclick=()=>a(l),l},ye=({shapeId:e=0,wingsId:t=0,bgColor:a=0,fgColor:n=0,bgEffect:r=0,pallete:o=0,backCover:i=0})=>{let c={shapeId:e,wingsId:t,bgColor:a,fgColor:n,bgEffect:r,pallete:o,backCover:i};const d=(e=>{const t=s("canvas");l(t,"width",200),l(t,"height",300);const a=t.getContext("2d");let n=0,r=0,o=0;const i=e=>{n=e,r=P[n][0],o=255*P[n][1]};return i(e),{canvas:t,setIndex:i,draw:e=>{a.save(),a.fillStyle=`rgba(${o},${o},${o}, 0.1)`,a.fillRect(0,0,200,300),a.fillStyle="#888",a.strokeStyle=a.fillStyle,r>=0&&e[r].forEach((e=>{a.save(),e.draw(a),a.restore()})),a.restore()}}})(r);de.push(d.draw);let h=me(e,t,a,n);const p=fe(i,[d.canvas,h],Me);return ve(c.pallete),{cardElement:p,setShipConfiguration:e=>{c={...c,...e},h=me(c.shapeId,c.wingsId,c.bgColor,c.fgColor),d.setIndex(c.bgEffect),ve(c.pallete)}}},be=e=>we(ge[e]);(()=>{const e={};for(let t=0;ge.length<13312;t++){const a=ue(t),n=a.adn.substring(0,5);e[n]?e[n]+=1:(e[n]=1,ge.push(a.adn))}})();const ze=[{0:"M15 17c-1 2 2 5 5 3a21 20 0 0 0 4-6m-14 1c0 1 5 8 8-5m3 9c-1 4 4 4 5 3 0 0 3-4 4-8m-18 9a20 10-50 0 0-6-7c2-2 4-3 9-3 3 0 5-6-1-6 0 0-6 0-11 3-3 3-8 21 12 21 9 0 15-10 15-16 0-4-3-5-5-3m0 0a2 2 0 0 0-6-3c2-4-3-6-5-4 1-3-4-6-8-2-3 3-5 12-5 11m7-8L7 8",1:"0 0 32 32"},{0:"M18 35c-2-7-7-7-9-8a14 14 0 0 1-3-3c-5-5-7 1-4 3s6 4 6 7c1 9 14 10 18 8 7-4 2-11 13-28 2-3-2-5-3-2-4 7-5 10-6 10s-1-4 1-16a2 2 0 1 0-4-1c-2 11-2 16-4 15-1 0-1-5-1-17 0-3-5-4-5 0 0 12 1 17-1 17s-2-4-4-15c0-3-5-2-4 1 2 10 4 18 2 21",1:"-1 -1 42 45"},{0:"m17 24-2 5c-1 2 1 7 4 3 1-1 4-8 3-6m-4 7c0 3 4 3 5 1l3-6m-16 7a5 8-1 0 0-1-4 4 3 10 0 0-4-2l5-2 4-1c3-1 3-5-1-5-1 0-8 2-10 3-6 5-1 19 11 19 6 0 11-9 12-14 1-4-4-5-4-3 2-3 0-6-3-5-4 1-3-5-2-18 0-3-5-3-5 1-1 12-1 16-3 16S7 15 7 5c0-4-5-4-5 0 1 9 1 15 0 20",1:"0 0 32 44"}],$e=[[0,0],[1,1],[2,2],[0,1],[0,2],[1,0],[1,2],[2,0],[2,1]],Le=(e,t)=>{const a=n("svg");l(a,"viewBox",e[1]),l(a,"class",`opt${t}`);const s=n("path");return l(s,"d",e[0]),l(s,"class","cls-1"),r(a,s),a};let Ce=[!1,!1,!1];const ke="winner",Ve="loser",He="tie",Se={[ke]:1,[He]:0,[Ve]:-1},Ie=(e,t,a=!1)=>{let n=$e[e][a?1:0],s=$e[t][a?1:0];return 0===n&&2===s||1===n&&0===s||2===n&&1===s?ke:n===s?He:Ve},Te=(e,t)=>{const a=ye(e);return t.appendChild(a.cardElement),a.cardElement.onclick=()=>{ve(e.pallete)},a.cardElement},Ae=(e,t,a)=>(e.innerHTML="",t.map(((t,n)=>{const s=$e[t].map(((e,t)=>Le(ze[e],t))),l=fe(a,s,(e=>e),"arsenal");return e.appendChild(l),l.style.top=`-${15*n}vh`,l}))),xe=e=>{const t=e.querySelectorAll("svg");t[0].setAttribute("class","opt1"),t[1].setAttribute("class","opt0")},Be=async(e,t,n,s,l=!1)=>{await a(l?400:600),!l&&Me(e),!l&&Me(t),await a(l?0:600);let r=Ie(n,s,l);return i(e,r),i(t,r),l||r!==He?Se[r]:(await a(600),c(e,r),c(t,r),xe(e),xe(t),await Be(e,t,n,s,!0))},Ee=async(e,t,n,s)=>{const l=Ae(sideA,n,e),r=Ae(sideB,s,t);await a(100),l.forEach((e=>e.style.top=0)),r.forEach((e=>e.style.top=0));let o=0;for(let e=0;e<l.length&&Math.abs(o)<2;e++)o+=await Be(l[e],r[e],n[e],s[e]);return o},Ne=async()=>{await a(500);const e=sideA.querySelectorAll(".card"),t=sideB.querySelectorAll(".card"),n=e.length;for(let a=0;a<n;a++)d(e[a],"cf")&&Me(e[a]),d(t[a],"cf")&&Me(t[a]);await a(300);for(let a=0;a<n;a++)i(e[a],"vanish"),i(t[a],"vanish");await a(800)},Pe=async e=>{const t=be(e.shipA),n=be(e.shipB),s="<ul class='victories'><li></li><li></li></ul>";playerA.innerHTML=s,playerB.innerHTML=s,sideA.innerHTML="",sideB.innerHTML="";const l=Te(t,playerA),r=Te(n,playerB);ve(t.pallete),await a(400),Me(l),await a(300),h(viewBattle.querySelector("h3"),"hide"),await a(300),Me(r),await a(400);let o=[0,0],c=!1;for(let s=0;s<e.rounds.length&&!c;s++){let l="point!!!";const{handA:r,handB:d}=e.rounds[s],h=await Ee(t.backCover,n.backCover,r.map((t=>e.arsenalA[t])),d.map((t=>e.arsenalB[t])));h>0&&(o[0]++,i(playerA.querySelector(`li:nth-child(${o[0]})`),"score")),h<0&&(o[1]++,i(playerB.querySelector(`li:nth-child(${o[1]})`),"score")),0==h&&(l="draw!!!"),c=o[0]>=2||o[1]>=2,await a(500),c||(await De(l),await Ne())}e.winner===te.id?1===ae.totalPlayers?(gameOver=!0,td("chicken-dinner")):td("battle-win"):(gameOver=!0,td("battle-lose"))};let qe="index";const Oe=e=>{i(o(qe),"hide"),c(o(e),"hide"),qe=e},je=()=>{h(joinGamebtn,"hide"),h(joinGameLabel,"hide"),netSelect.disabled=!netSelect.disabled};let Ge,Re="",Fe=!1,_e={rules:{max:-40},join:{max:-14,disableLinks:!0,onOpen:async()=>{if(0==credits)return td();await a(1500),ne!=Q[K]&&(3===await contract.joinGame()?U(credits-1):p("pS",te.alive)),md(-14),await a(1300),td(),ne==Q[K]&&(async()=>{await a(350),(async()=>{Fe&&await td();for(let e=0;e<4;e++)ee.push(se(e));ae.totalPlayers=ee.length,te={...ee[0]},td("wait"),le()})()})(),je()}},wait:{max:-14,disableLinks:!0,onOpen:async()=>{await a(800),md(-14),await a(1200),Oe("game"),at(),await a(600),td()}},"battle-lose":{max:-14,onOpen:async()=>{await a(1200),md(-14)},onClose:v},"battle-win":{max:-14,disableLinks:!0,onOpen:async()=>{await a(2e3),md(-14),await a(3e3),td()},onClose:()=>{Oe("game"),ne==Q[K]&&(te.arsenal.push(z(0,9)),ae.round+=1,ae.totalPlayers=ee.length,te.victories+=1),te.hand=[],Ce=[!1,!1,!1],tt=0,at()}},"chicken-dinner":{max:-28,top:60,onOpen:async()=>{const e=`<a class='da' href='?id=${te.shipId}' target='_blank'>#${te.shipId}</a>`;ne==Q[K]?winnerMessage.innerHTML="Now you can Join to the<br>Near blockchain to earn<br>spaceships NFTs":winnerMessage.innerHTML=`The NFT ${e} is beeing<br>assigned to your wallet!`,i(playerA.querySelector(".card"),"chicken"),await a(2e3),md(-14),await a(3e3)},onClose:v}};md=e=>{dialogTop+=e,dialogTop<Ge&&(dialogTop-=e),dialogTop>0&&(dialogTop=0),dlt.style.top=`${dialogTop}vh`},joinGamebtn.onclick=()=>credits<1?De("not enough credits"):td("join");const De=async(e,t=1200)=>{document.querySelector("#dl-custom p").innerHTML=e;let n=e=>e;const s=new Promise((e=>n=e));return _e.custom={max:0,disableLinks:!0,onOpen:async()=>{0!=t&&(await a(t),td())},onClose:n},this.td("custom"),s};let Ue;td=async(e=Re,t)=>{dialogTop=0,dlt.style.top=`${dialogTop}vh`;const n=o(`dl-${e}`);let s=d(n,"hide");Re=e;let{max:l,disableLinks:r,onOpen:p,onClose:m,top:v=35}=t||_e[e];Ge=l;const g=dl.querySelectorAll("a");for(let e=0;e<g.length;e++)r?i(g[e],"hide"):c(g[e],"hide");s?(h(n,"hide"),h(dl,"hide"),await a(1),dlb.style.top=`${v}vh`,dlb.style.opacity="1",await a(300),p&&p(),Fe=!0):(await a(1),dlb.style.top="100vh",dlb.style.opacity="0",await a(300),dlb.style.top="0vh",h(n,"hide"),h(dl,"hide"),m&&m(),Fe=!1)};const We=e=>Ue=Date.now()+18e4+e;We(0);const Je=[[],[],[],[],[]],Ke=()=>{let t=~~(300*e()),a=-50,n=5*e()+5;Je[0].push({move:t=>a=a+n>300?(n=5*e()+5)||-50:a+n,draw:e=>e.fillRect(t,a,2,4)})},Qe=()=>{let t=5*e()+0,a=e()*Math.PI*2,n=-1,s=-1,l=0,r=0;Je[1].push({move:o=>{s+=r,n+=l,(s<0||s>300||n<0||n>200)&&(n=100,s=150,a=e()*Math.PI*2,l=Math.cos(a)*t,r=Math.sin(a)*t)},draw:e=>{e.translate(n,s),e.rotate(a),e.fillRect(0,-15,1,30)}})},Xe=()=>{let t=-1,a=e()+1;Je[2].push({move:n=>{t+=a,(t<0||t>200)&&(t=100,a=e()+1)},draw:e=>{e.globalAlpha=1-(200-t)/100,e.fillRect(t,0,2,300),e.fillRect(200-t,0,2,300)}})},Ye=()=>{let t=e()+1,a=50*e();Je[3].push({move:e=>{a+=t,a>200&&(a=1)},draw:e=>{e.translate(100,150),e.beginPath(),e.strokeWidth=2,e.arc(0,0,a,0,2*Math.PI,!1),e.stroke()}})},Ze=()=>{let t=e()+1,a=200*e(),n=e()*Math.PI*2;Je[4].push({move:e=>{a+=t,n+=.01,a>200&&(a=1)},draw:e=>{e.translate(100,150),e.rotate(3*Math.PI/4),e.strokeRect(-a,-a,2*a,2*a)}})};for(let e=0;e<10;e++)Xe(),Ze();for(let e=0;e<100;e++)Qe(),Ke();for(let e=0;e<30;e++)Ye();const et=["waiting for orders","ready for battle"];let tt=0;const at=()=>{if(!ship.children.length){const e=be(te.shipId),t=ye(e);ship.appendChild(t.cardElement)}gameStats.innerHTML=`\n<tr><td>spacewar: #${ae.id}</td><td>${ne}</td></tr>\n<tr><td>round: #${ae.round}</td><td>next battle: <span id='timer'></td></tr>\n<tr><td>remaining ships: ${ae.totalPlayers}</td><td>${2==ae.totalPlayers?" - last round -":""}</td></tr>\n  `,shipStats.innerHTML=`\n<span class='shipName'>${O[te.config.shapeId]} ${j[te.config.wingsId]}</span>\n<hr>\n<span>spaceship: <a href='https://bafybeifh3mmbyccjo64qjr6thhphyspnxirtcv6rxb3bsip5noaicv5v4i.ipfs.dweb.link?id=${te.shipId}' target='_blank'>#${te.shipId}</a></span>\n<span>galaxy: ${G[te.config.bgEffect]}</span>\n<span>faction: ${q[te.config.backCover]}</span>\n<span>victories: ${te.victories}</span>\n<hr>\n<a id='blMe' href='#'>${et[tt]}</a>`,group.innerHTML="",te.arsenal.forEach(((e,t)=>group.appendChild(((e,t)=>{const a=$e[e].map(((e,t)=>Le(ze[e],t))),n=s("div");n.className="order",a.push(n);const l=fe(1,a,(e=>{((e,t,a)=>{const n=te.hand.indexOf(a),s=-1==n;if(!(s&&te.hand.length>=3))if(h(e,"selected"),s){te.hand.push(a);let e=Ce.indexOf(!1);t.innerHTML=e+1,Ce[e]=!0}else te.hand.splice(n,1),Ce[parseInt(t.innerHTML)-1]=!1})(l,n,t)}),"arsenal");return Me(l),l})(e,t))))};netSelect.onchange=e=>{if(ne=netSelect.value,p("net",ne),ne==K)return v();_(!0)},ee=[],te={id:-1,shipId:0,alive:!0,arsenal:[0,1,2,z(0,9)],hand:[],ready:!1,victories:0},ae={id:z(0,1e3),state:Z[X],totalPlayers:0,round:0},(async()=>{ne=m("net",K),netSelect.value=ne,ne!==K&&await _()})();const nt=()=>{(()=>{const e=Ue-Date.now();e<0&&We(e);const t=~~(e/6e4),a=(~~((e-60*t*1e3)/1e3)).toString().padStart(2,"0");dgs.innerHTML=`game will start in ${t}:${a}`;const n=o("timer");n&&(n.innerHTML=`${t}:${a}`)})(),Je.forEach((e=>e.forEach((e=>e.move())))),de.forEach((e=>e(Je))),requestAnimationFrame(nt)};nt()})();